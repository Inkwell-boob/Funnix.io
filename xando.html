<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>X&O Multiplayer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { text-align:center; font-family: 'Press Start 2P', sans-serif; background:#121212; color:white; margin:0; padding:0;}
h1 { color:#ff4081; margin-top:40px;}
.board { display:grid; grid-template-columns:repeat(3,100px); grid-gap:5px; justify-content:center; margin:20px auto;}
.cell { width:100px; height:100px; background:#333; display:flex; align-items:center; justify-content:center; font-size:2rem; cursor:pointer; border-radius:8px; transition:0.2s;}
.cell:hover { transform:scale(1.05); box-shadow:0 0 10px #ff4081;}
input, button { padding:5px 10px; font-size:1rem; margin:5px; border-radius:5px; border:none; }
button { cursor:pointer; background:#ff4081; color:white; }
#winner { font-size:1.5rem; color:#00ff00; margin-top:20px; text-shadow:0 0 10px #00ff00; display:none;}
</style>
</head>
<body>
<h1>X&O Multiplayer</h1>

<div>
  <button onclick="createRoom()">Create Room</button>
  <input id="roomInput" placeholder="Enter Room Code">
  <button onclick="joinRoom()">Join Room</button>
</div>

<h2 id="status">Status: Waiting...</h2>
<div class="board" id="board">
  <div class="cell" data-index="0"></div>
  <div class="cell" data-index="1"></div>
  <div class="cell" data-index="2"></div>
  <div class="cell" data-index="3"></div>
  <div class="cell" data-index="4"></div>
  <div class="cell" data-index="5"></div>
  <div class="cell" data-index="6"></div>
  <div class="cell" data-index="7"></div>
  <div class="cell" data-index="8"></div>
</div>
<div id="winner">Winner: </div>

<script>
const firebaseConfig = {
  apiKey: "8079660368:AAGMxDRyJUem69AQhXZxnPKK9KH3mD3kR7E",
  authDomain: "funnix-f4632.firebaseapp.com",
  databaseURL: "https://funnix-f4632-default-rtdb.firebaseio.com",
  projectId: "funnix-f4632",
  storageBucket: "funnix-f4632.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const cells = document.querySelectorAll('.cell');
const status = document.getElementById('status');
const winnerEl = document.getElementById('winner');

let boardState = Array(9).fill(null);
let player = '';
let currentTurn = 'X';
let gameOver = false;
let roomRef = null;

const winCombos = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function createRoom(){
  const code = Math.random().toString(36).substring(2,7).toUpperCase();
  roomRef = db.ref('rooms/' + code);
  roomRef.set({board:Array(9).fill(null), turn:'X', winner:null, players:['X']});
  player = 'X';
  status.innerText = `Room: ${code} | You are X | Waiting for opponent...`;
  listenBoard();
}

function joinRoom(){
  const code = document.getElementById('roomInput').value.toUpperCase();
  if(!code) return alert('Enter a valid room code');
  roomRef = db.ref('rooms/' + code);
  roomRef.once('value', snapshot=>{
    const data = snapshot.val();
    if(!data) return alert('Room not found!');
    if(data.players.length>=2) return alert('Room full!');
    player = 'O';
    roomRef.update({players:['X','O']});
    status.innerText = `Joined Room: ${code} | You are O`;
    listenBoard();
  });
}

function listenBoard(){
  roomRef.on('value', snapshot=>{
    const data = snapshot.val();
    boardState = data.board;
    currentTurn = data.turn;
    gameOver = !!data.winner;
    updateBoard();
    if(data.players.length<2 && player==='X'){
      status.innerText = `Room: ${snapshot.key} | You are X | Waiting for opponent...`;
      return;
    }
    if(data.winner){
      winnerEl.style.display='block';
      winnerEl.innerText = data.winner==='Draw' ? 'Draw!' : `Winner: ${data.winner}`;
      highlightWinner(getWinnerCombo());
    } else winnerEl.style.display='none';
    status.innerText = `Room: ${snapshot.key} | Your mark: ${player} | Next turn: ${currentTurn}`;
  });
}

function updateBoard(){
  cells.forEach((cell,i)=>{
    cell.innerText = boardState[i] ? boardState[i] : '';
    cell.style.boxShadow='';
  });
}

function makeMove(index){
  if(gameOver || currentTurn!==player || boardState[index]) return;
  boardState[index]=player;
  const winner = checkWinner();
  roomRef.update({board:boardState, turn:player==='X'?'O':'X', winner:winner});
}

function checkWinner(){
  for(const combo of winCombos){
    const [a,b,c] = combo;
    if(boardState[a] && boardState[a]===boardState[b] && boardState[a]===boardState[c]){
      return boardState[a];
    }
  }
  if(!boardState.includes(null)) return 'Draw';
  return null;
}

function getWinnerCombo(){
  for(const combo of winCombos){
    const [a,b,c] = combo;
    if(boardState[a] && boardState[a]===boardState[b] && boardState[a]===boardState[c]) return combo;
  }
  return [];
}

function highlightWinner(combo){
  combo.forEach(i=>cells[i].style.boxShadow='0 0 25px #00ff00');
}

cells.forEach((cell,i)=>{
  cell.addEventListener('click',()=>makeMove(i));
});
</script>

</body>
</html>